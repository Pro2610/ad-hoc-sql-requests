WITH weekly_segment AS (
  SELECT
    DATE_TRUNC(DATE(payment_date), WEEK(MONDAY)) AS week,
    location,
    software_name,
    `User Type` AS user_type,
    SUM(revenue_amount) AS revenue,
    COUNT(DISTINCT user_id) AS paid_users
  FROM `project.dataset.payments`
  WHERE DATE(payment_date) >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 WEEK)
  GROUP BY 1,2,3,4
)
